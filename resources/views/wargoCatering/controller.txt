<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

class PesananController extends Controller
{
    public function addToCart(Request $request)
    {

        // Validasi request jika diperlukan
        $request->validate([
            'menu_id' => 'required',
            'nama' => 'required|string',
            'harga' => 'required|numeric',
            'kategori' => 'required|string',
            'gambar' => 'required|string',
            'jumlah' => 'required|integer|min:15',
        ]);

        // Simpan data menu ke dalam session (cart)
        $menu = [
            'menu_id' => $request->input('menu_id'),
            'nama' => $request->input('nama'),
            'harga' => $request->input('harga'),
            'kategori' => $request->input('kategori'),
            'gambar' => $request->input('gambar'),
            'jumlah_pesanan' => $request->input('jumlah'),
        ];

        // Cek apakah menu sudah ada dalam cart
        $cart = session()->get('cart', []);
        foreach ($cart as $cartItem) {
            if ($cartItem['nama'] === $menu['nama']) {
                // Menu sudah ada dalam cart, tolak menu tambahan dengan memberikan pesan error
                return back()->withErrors(['duplicate_menu' => 'Menu tersebut sudah ada dalam keranjang belanja.']);
            }
        }

        // Jika menu belum ada dalam cart, tambahkan menu ke dalam session (cart)
        session()->push('cart', $menu);

        // Redirect atau kembalikan respon sesuai kebutuhan
        return redirect('/cart');
    }

    public function removeCartItem($id)
    {
        // Dapatkan data cart dari session
        $cart = session()->get('cart', []);

        // Cari index item menu yang ingin dihapus dalam data cart
        $itemIndex = null;
        foreach ($cart as $index => $item) {
            if ($item['menu_id'] === $id) {
                $itemIndex = $index;
                break;
            }
        }

        // Hapus item menu dari data cart jika ditemukan
        if ($itemIndex !== null) {
            unset($cart[$itemIndex]);

            // Simpan kembali data cart yang telah diperbarui ke dalam session
            session()->put('cart', $cart);
        }

        // Redirect atau kembalikan respon sesuai kebutuhan
        return redirect('/cart');
    }
}
